#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh" 2>/dev/null || true

# Só roda se houver arquivos staged dentro de web/
if ! git diff --cached --name-only | grep -q '^web/'; then
  exit 0
fi

echo "🔎 Executando lint-staged em web/ ..."
cd "web"

# Preferir o binário local do projeto, assim não dependemos de pnpm/yarn na raiz
if [ -x "./node_modules/.bin/lint-staged" ]; then
  node ./node_modules/.bin/lint-staged
else
  echo "ℹ️ ./node_modules/.bin/lint-staged não encontrado. Tentando npx (fallback)..."
  npx --yes lint-staged || {
    echo "❌ lint-staged não encontrado. Rode 'pnpm i' ou 'npm i' dentro de web/";
    exit 1
  }
fi
